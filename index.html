<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English 9 Global Success (Unit 7-9) - Bilingual Practice</title>
    <style>
        :root { --primary: #00838f; --secondary: #00acc1; --bg: #e0f7fa; --explain-bg: #fff3e0; --explain-text: #e65100; --trans-text: #1565c0; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #b2ebf2 0%, #e0f7fa 100%); margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; user-select: none; padding-bottom: 50px; }
        
        .falling-flowers { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; opacity: 0.6; }
        .flower { position: absolute; top: -20px; animation: fall linear infinite; font-size: 20px;}
        @keyframes fall { to { transform: translateY(105vh) rotate(720deg); } }
        
        .container { 
            background: rgba(255,255,255,0.99); 
            border-radius: 16px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); 
            padding: 40px; 
            max-width: 900px; 
            width: 90%; 
            margin-top: 30px; 
            text-align: center; 
            z-index: 1; 
            border-top: 6px solid var(--primary); 
            position: relative;
            min-height: 350px;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .screen { width: 100%; }
        .hidden { display: none !important; }

        /* Ti√™u ƒë·ªÅ */
        h1 { color: var(--primary); margin: 0 0 10px 0; font-size: 2.2rem; text-transform: uppercase; letter-spacing: 1px; }
        h2 { color: #546e7a; font-weight: normal; margin-bottom: 30px; }

        /* Question Box */
        .question-box { 
            background: #fff; 
            padding: 25px; 
            border-radius: 12px; 
            margin: 20px 0; 
            font-size: 1.25rem; 
            color: #263238; 
            font-weight: 600; 
            border: 1px solid #cfd8dc; 
            text-align: left;
            line-height: 1.6;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
        }
        
        /* Reading Text Style */
        .reading-text {
            font-weight: normal;
            font-size: 1rem;
            background: #f1f8e9;
            padding: 15px;
            border-left: 4px solid #8bc34a;
            margin-bottom: 15px;
            white-space: pre-line;
            color: #33691e;
        }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        
        .btn-option { 
            background: white; 
            border: 2px solid #b0bec5; 
            padding: 15px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            transition: 0.2s; 
            width: 100%; 
            text-align: left;
            color: #455a64;
            min-height: 60px;
            display: flex; align-items: center;
        }
        .btn-option:hover { background: #e0f7fa; border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        .btn-option.correct { background: #c8e6c9 !important; border-color: #4caf50 !important; color: #1b5e20; font-weight: bold; }
        .btn-option.wrong { background: #ffcdd2 !important; border-color: #e53935 !important; color: #b71c1c; opacity: 0.7; }
        
        /* Explanation & Translation Area */
        .explanation-box { margin-top: 25px; padding: 20px; background-color: var(--explain-bg); color: #333; border-radius: 12px; border-left: 6px solid #ff9800; text-align: left; font-size: 1rem; animation: slideDown 0.4s; }
        .explanation-title { font-weight: bold; color: #e65100; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px; margin-bottom: 5px; display: block;}
        .trans-text { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ffcc80; color: var(--trans-text); font-style: italic; display: block; font-weight: 500;}

        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 50px; border-radius: 30px; font-size: 1.3rem; cursor: pointer; margin-top: 20px; box-shadow: 0 5px 15px rgba(0, 131, 143, 0.3); transition: transform 0.1s; font-weight: bold; }
        .btn-main:active { transform: scale(0.95); }
        .btn-next { background: #ffca28; color: #333; display: none; margin: 20px auto 0; width: 100%; max-width: 350px; }
        
        .info-bar { display: flex; justify-content: space-between; font-weight: bold; color: var(--primary); margin-bottom: 20px; font-size: 1.1rem; border-bottom: 2px solid #b2ebf2; padding-bottom: 15px; }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Music Button */
        #music-control { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: white; border: 3px solid var(--primary); color: var(--primary); font-size: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 100; transition: all 0.3s; }
        .music-playing { animation: pulse 2s infinite; background: var(--primary) !important; color: white !important; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 131, 143, 0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(0, 131, 143, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 131, 143, 0); } }
    </style>
</head>
<body>
    <div class="falling-flowers" id="flowers"></div>
    
    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" type="audio/mpeg">
    </audio>
    <div id="music-control" onclick="toggleMusic()">üéµ</div>

    <div class="container">
        <div id="start-screen" class="screen">
            <h1>ENGLISH 9 GLOBAL SUCCESS</h1>
            <h2>Unit 7 - Unit 8 - Unit 9</h2>
            <div style="font-size: 5rem; margin: 30px;">üè∞ ‚úàÔ∏è üó£Ô∏è</div>
            <p style="font-size: 1.2rem; line-height: 1.8;">
                <b>Unit 7:</b> Natural Wonders (B·ªã ƒë·ªông kh√°ch quan)<br>
                <b>Unit 8:</b> Tourism (M·∫°o t·ª´ & Danh t·ª´ gh√©p)<br>
                <b>Unit 9:</b> World Englishes (M·ªánh ƒë·ªÅ quan h·ªá & C√¢u ƒëi·ªÅu ki·ªán)
            </p>
            <button class="btn-main" onclick="startGame()">B·∫ÆT ƒê·∫¶U LUY·ªÜN T·∫¨P ‚ñ∂</button>
        </div>

        <div id="game-ui" class="screen hidden">
            <div class="info-bar">
                <span id="score-display">Score: 0</span>
                <span id="progress-display">Question: 1/150</span>
            </div>
            
            <div class="question-box" id="question-text">Loading...</div>
            <div class="options-grid" id="options-container"></div>
            
            <div id="explanation-area" class="explanation-box hidden">
                <span class="explanation-title">üí° Explanation:</span>
                <span id="explanation-text"></span>
                <span id="trans-text" class="trans-text"></span>
            </div>

            <button id="btn-next" class="btn-main btn-next" onclick="nextQuestion()">‚û° NEXT QUESTION</button>
        </div>

        <div id="end-screen" class="screen hidden">
            <h1 style="color:var(--primary)">K·∫æT QU·∫¢</h1>
            <div style="font-size: 5rem; margin: 20px;">üèÜ</div>
            <h2 id="final-score" style="color: #00838f; font-size: 2.5rem;"></h2>
            <p>B·∫°n ƒë√£ ho√†n th√†nh 150 c√¢u h·ªèi √¥n t·∫≠p Ti·∫øng Anh 9!</p>
            <button class="btn-main" onclick="location.reload()">L√ÄM L·∫†I üîÑ</button>
        </div>
    </div>

<script>
    // ========================================================================
    // DATABASE: GLOBAL SUCCESS 9 (UNIT 7-8-9) - 150 QUESTIONS
    // ========================================================================
    const rawQuestions = [
        // --- UNIT 7: NATURAL WONDERS OF THE WORLD ---
        // Vocab
        {q: "Choose the word whose underlined part is pronounced differently: <br>c<u>a</u>vern, c<u>i</u>tadel, l<u>o</u>cate, p<u>a</u>goda", a: ["locate", "cavern", "citadel", "pagoda"], correct: 0, explain: "'locate' √¢m 'a' ph√°t √¢m /e…™/. C√°c t·ª´ c√≤n l·∫°i l√† √¢m /…ô/ ho·∫∑c /√¶/.", trans: "D·ªãch: locate (ƒë·ªãnh v·ªã) - cavern (hang ƒë·ªông l·ªõn) - citadel (th√†nh qu√°ch) - pagoda (ch√πa)."},
        {q: "Son Doong is the largest ______ in the world.", a: ["cave", "cavern", "fortress", "tomb"], correct: 0, explain: "Cave (hang ƒë·ªông). Son Doong l√† hang ƒë·ªông l·ªõn nh·∫•t th·∫ø gi·ªõi.", trans: "D·ªãch: S∆°n ƒêo√≤ng l√† hang ƒë·ªông l·ªõn nh·∫•t th·∫ø gi·ªõi."},
        {q: "The Imperial ______ of Thang Long is a complex of historic buildings.", a: ["Citadel", "Setting", "Complex", "Monument"], correct: 0, explain: "The Imperial Citadel (Ho√†ng th√†nh).", trans: "D·ªãch: Ho√†ng th√†nh ThƒÉng Long l√† m·ªôt qu·∫ßn th·ªÉ c√°c c√¥ng tr√¨nh l·ªãch s·ª≠."},
        {q: "This building is a masterpiece of ______.", a: ["architecture", "geology", "administration", "measure"], correct: 0, explain: "Architecture (ki·∫øn tr√∫c).", trans: "D·ªãch: T√≤a nh√† n√†y l√† m·ªôt ki·ªát t√°c ki·∫øn tr√∫c."},
        {q: "Ha Long Bay is famous for its thousands of ______ islands.", a: ["limestone", "brick", "concrete", "sand"], correct: 0, explain: "Limestone (ƒë√° v√¥i).", trans: "D·ªãch: V·ªãnh H·∫° Long n·ªïi ti·∫øng v·ªõi h√†ng ng√†n ƒë·∫£o ƒë√° v√¥i."},
        {q: "The local government has taken measures to ______ the old fortress.", a: ["preserve", "destroy", "build", "imagine"], correct: 0, explain: "Preserve (b·∫£o t·ªìn).", trans: "D·ªãch: Ch√≠nh quy·ªÅn ƒë·ªãa ph∆∞∆°ng ƒë√£ th·ª±c hi·ªán c√°c bi·ªán ph√°p ƒë·ªÉ b·∫£o t·ªìn ph√°o ƒë√†i c·ªï."},
        {q: "It is a ______ complex with many temples and tombs.", a: ["magnificent", "bad", "small", "cheap"], correct: 0, explain: "Magnificent (hung vƒ©/tr√°ng l·ªá).", trans: "D·ªãch: ƒê√≥ l√† m·ªôt qu·∫ßn th·ªÉ tr√°ng l·ªá v·ªõi nhi·ªÅu ƒë·ªÅn ƒë√†i v√† lƒÉng t·∫©m."},
        
        // Grammar Unit 7: Impersonal Passive (It is said that...)
        {q: "People say that this cave is very deep. <br>-> It is ______ that this cave is very deep.", a: ["said", "say", "saying", "says"], correct: 0, explain: "C·∫•u tr√∫c: It is said that + S + V (Ng∆∞·ªùi ta n√≥i r·∫±ng...).", trans: "D·ªãch: Ng∆∞·ªùi ta n√≥i r·∫±ng hang ƒë·ªông n√†y r·∫•t s√¢u."},
        {q: "They believe that the fortress was built in the 15th century. <br>-> It is ______ that the fortress was built in the 15th century.", a: ["believed", "believe", "believing", "belief"], correct: 0, explain: "C·∫•u tr√∫c: It is believed that...", trans: "D·ªãch: Ng∆∞·ªùi ta tin r·∫±ng ph√°o ƒë√†i ƒë∆∞·ª£c x√¢y d·ª±ng v√†o th·∫ø k·ª∑ 15."},
        {q: "People think that Ha Long Bay is the most beautiful place. <br>-> Ha Long Bay is ______ to be the most beautiful place.", a: ["thought", "think", "thinking", "thoughts"], correct: 0, explain: "B·ªã ƒë·ªông c√° nh√¢n: S + is + V3 (thought) + to V.", trans: "D·ªãch: V·ªãnh H·∫° Long ƒë∆∞·ª£c cho l√† n∆°i ƒë·∫πp nh·∫•t."},
        
        // --- UNIT 8: TOURISM ---
        // Vocab
        {q: "We booked a ______ tour to Thailand, so everything was included.", a: ["package", "packing", "packed", "pack"], correct: 0, explain: "Package tour (du l·ªãch tr·ªçn g√≥i).", trans: "D·ªãch: Ch√∫ng t√¥i ƒë√£ ƒë·∫∑t m·ªôt chuy·∫øn du l·ªãch tr·ªçn g√≥i ƒë·∫øn Th√°i Lan, v√¨ v·∫≠y m·ªçi th·ª© ƒë√£ bao g·ªìm."},
        {q: "Try the local ______. It's delicious!", a: ["cuisine", "custom", "habit", "costume"], correct: 0, explain: "Cuisine (·∫©m th·ª±c).", trans: "D·ªãch: H√£y th·ª≠ ·∫©m th·ª±c ƒë·ªãa ph∆∞∆°ng. N√≥ r·∫•t ngon!"},
        {q: "I suffer from ______ after the long flight from London to Hanoi.", a: ["jet lag", "bus lag", "car sick", "headache"], correct: 0, explain: "Jet lag (l·ªách m√∫i gi·ªù).", trans: "D·ªãch: T√¥i b·ªã l·ªách m√∫i gi·ªù sau chuy·∫øn bay d√†i t·ª´ London v·ªÅ H√† N·ªôi."},
        {q: "The hotel ______ time is 12:00 PM.", a: ["checkout", "check-in", "checking", "checked"], correct: 0, explain: "Checkout time (gi·ªù tr·∫£ ph√≤ng).", trans: "D·ªãch: Gi·ªù tr·∫£ ph√≤ng c·ªßa kh√°ch s·∫°n l√† 12 gi·ªù tr∆∞a."},
        {q: "We went on a ______ to see lions and elephants in the wild.", a: ["safari", "picnic", "cruise", "voyage"], correct: 0, explain: "Safari (cu·ªôc ƒëi sƒÉn/du l·ªãch quan s√°t ƒë·ªông v·∫≠t hoang d√£).", trans: "D·ªãch: Ch√∫ng t√¥i ƒë√£ ƒëi du l·ªãch th√°m hi·ªÉm ƒë·ªÉ xem s∆∞ t·ª≠ v√† voi trong t·ª± nhi√™n."},
        {q: "The view from the mountain was ______.", a: ["breathtaking", "breathless", "breath", "breathe"], correct: 0, explain: "Breathtaking (ngo·∫°n m·ª•c/ƒë·∫πp ƒë·∫øn ngh·∫πt th·ªü).", trans: "D·ªãch: C·∫£nh quan t·ª´ tr√™n n√∫i th·∫≠t ngo·∫°n m·ª•c."},
        {q: "This resort is quite ______ for students.", a: ["affordable", "rich", "expensive", "priceless"], correct: 0, explain: "Affordable (gi√° c·∫£ ph·∫£i chƒÉng).", trans: "D·ªãch: Khu ngh·ªâ d∆∞·ª°ng n√†y c√≥ gi√° kh√° ph·∫£i chƒÉng cho sinh vi√™n."},

        // Grammar Unit 8: Compound Nouns & Articles
        {q: "A ______ is a time when a plane lands.", a: ["touchdown", "touch-down", "touch down", "touching down"], correct: 0, explain: "Touchdown (s·ª± h·∫° c√°nh). Danh t·ª´ gh√©p vi·∫øt li·ªÅn.", trans: "D·ªãch: Touchdown l√† th·ªùi ƒëi·ªÉm m√°y bay h·∫° c√°nh."},
        {q: "Don't forget to put on ______ before going to the beach.", a: ["sunscreen", "sunburn", "sunglasses", "sunshine"], correct: 0, explain: "Sunscreen (kem ch·ªëng n·∫Øng) - Compound noun.", trans: "D·ªãch: ƒê·ª´ng qu√™n b√¥i kem ch·ªëng n·∫Øng tr∆∞·ªõc khi ra bi·ªÉn."},
        {q: "I want to visit ______ Moon one day.", a: ["the", "a", "an", "√ò"], correct: 0, explain: "D√πng 'the' v·ªõi v·∫≠t th·ªÉ duy nh·∫•t (The Moon, The Sun).", trans: "D·ªãch: T√¥i mu·ªën thƒÉm M·∫∑t TrƒÉng m·ªôt ng√†y n√†o ƒë√≥."},
        {q: "She is ______ honest guide.", a: ["an", "a", "the", "√ò"], correct: 0, explain: "Honest b·∫Øt ƒë·∫ßu b·∫±ng √¢m c√¢m 'h' (/Àà…ín…™st/) -> d√πng 'an'.", trans: "D·ªãch: C√¥ ·∫•y l√† m·ªôt h∆∞·ªõng d·∫´n vi√™n trung th·ª±c."},
        {q: "I visited ______ Ho Chi Minh City last year.", a: ["√ò", "the", "a", "an"], correct: 0, explain: "Kh√¥ng d√πng m·∫°o t·ª´ tr∆∞·ªõc t√™n th√†nh ph·ªë (tr·ª´ The Hague...).", trans: "D·ªãch: T√¥i ƒë√£ ƒë·∫øn thƒÉm Th√†nh ph·ªë H·ªì Ch√≠ Minh nƒÉm ngo√°i."},
        {q: "Can you speak ______ Vietnamese?", a: ["√ò", "the", "a", "an"], correct: 0, explain: "Kh√¥ng d√πng m·∫°o t·ª´ tr∆∞·ªõc t√™n ng√¥n ng·ªØ.", trans: "D·ªãch: B·∫°n c√≥ th·ªÉ n√≥i ti·∫øng Vi·ªát kh√¥ng?"},

        // --- UNIT 9: WORLD ENGLISHES ---
        // Vocab
        {q: "English is used as a ______ in many international meetings.", a: ["lingua franca", "first language", "mother tongue", "dialect"], correct: 0, explain: "Lingua franca (ng√¥n ng·ªØ chung/ng√¥n ng·ªØ c·∫ßu n·ªëi).", trans: "D·ªãch: Ti·∫øng Anh ƒë∆∞·ª£c s·ª≠ d·ª•ng nh∆∞ ng√¥n ng·ªØ chung trong nhi·ªÅu cu·ªôc h·ªçp qu·ªëc t·∫ø."},
        {q: "She speaks English with a strong French ______.", a: ["accent", "vocabulary", "grammar", "skill"], correct: 0, explain: "Accent (gi·ªçng ƒëi·ªáu).", trans: "D·ªãch: C√¥ ·∫•y n√≥i ti·∫øng Anh v·ªõi gi·ªçng Ph√°p r·∫•t n·∫∑ng."},
        {q: "He is ______; he speaks both English and Vietnamese fluently.", a: ["bilingual", "monolingual", "trilingual", "lingual"], correct: 0, explain: "Bilingual (song ng·ªØ).", trans: "D·ªãch: Anh ·∫•y n√≥i song ng·ªØ; anh ·∫•y n√≥i tr√¥i ch·∫£y c·∫£ ti·∫øng Anh v√† ti·∫øng Vi·ªát."},
        {q: "People in different regions often use different ______.", a: ["dialects", "dictionaries", "spellings", "writings"], correct: 0, explain: "Dialects (ph∆∞∆°ng ng·ªØ).", trans: "D·ªãch: Ng∆∞·ªùi d√¢n ·ªü c√°c v√πng kh√°c nhau th∆∞·ªùng s·ª≠ d·ª•ng c√°c ph∆∞∆°ng ng·ªØ kh√°c nhau."},
        {q: "English has become a ______ language.", a: ["global", "local", "native", "small"], correct: 0, explain: "Global language (ng√¥n ng·ªØ to√†n c·∫ßu).", trans: "D·ªãch: Ti·∫øng Anh ƒë√£ tr·ªü th√†nh m·ªôt ng√¥n ng·ªØ to√†n c·∫ßu."},
        {q: "This program offers total ______ in English.", a: ["immersion", "immerse", "immersing", "immersed"], correct: 0, explain: "Immersion (s·ª± h√≤a nh·∫≠p/nh√∫ng m√¨nh v√†o m√¥i tr∆∞·ªùng ng√¥n ng·ªØ).", trans: "D·ªãch: Ch∆∞∆°ng tr√¨nh n√†y cung c·∫•p s·ª± h√≤a nh·∫≠p ho√†n to√†n v√†o ti·∫øng Anh."},

        // Grammar Unit 9: Relative Clauses & Conditional Type 2
        {q: "The girl ______ lives next door is Australian.", a: ["who", "which", "whose", "whom"], correct: 0, explain: "Who thay th·∫ø cho ng∆∞·ªùi (The girl) l√†m ch·ªß ng·ªØ.", trans: "D·ªãch: C√¥ g√°i s·ªëng b√™n c·∫°nh l√† ng∆∞·ªùi √öc."},
        {q: "The book ______ I bought yesterday is interesting.", a: ["which", "who", "whose", "where"], correct: 0, explain: "Which thay th·∫ø cho v·∫≠t (The book).", trans: "D·ªãch: Cu·ªën s√°ch t√¥i mua h√¥m qua r·∫•t th√∫ v·ªã."},
        {q: "This is the city ______ I was born.", a: ["where", "which", "that", "when"], correct: 0, explain: "Where = In which (thay th·∫ø cho n∆°i ch·ªën).", trans: "D·ªãch: ƒê√¢y l√† th√†nh ph·ªë n∆°i t√¥i sinh ra."},
        {q: "If I ______ you, I would learn English harder.", a: ["were", "am", "was", "be"], correct: 0, explain: "C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 2: If + S + were (cho m·ªçi ng√¥i)...", trans: "D·ªãch: N·∫øu t√¥i l√† b·∫°n, t√¥i s·∫Ω h·ªçc ti·∫øng Anh chƒÉm ch·ªâ h∆°n."},
        {q: "If he ______ rich, he would travel around the world.", a: ["were", "is", "will be", "has been"], correct: 0, explain: "ƒêi·ªÅu ki·ªán lo·∫°i 2 (kh√¥ng c√≥ th·∫≠t ·ªü hi·ªán t·∫°i).", trans: "D·ªãch: N·∫øu anh ·∫•y gi√†u, anh ·∫•y s·∫Ω ƒëi du l·ªãch v√≤ng quanh th·∫ø gi·ªõi."},
        {q: "She ______ buy that car if she had enough money.", a: ["would", "will", "can", "shall"], correct: 0, explain: "M·ªánh ƒë·ªÅ ch√≠nh ƒêK lo·∫°i 2: S + would + V.", trans: "D·ªãch: C√¥ ·∫•y s·∫Ω mua chi·∫øc xe ƒë√≥ n·∫øu c√¥ ·∫•y c√≥ ƒë·ªß ti·ªÅn."},

        // --- READING COMPREHENSION ---
        {
            q: "<div class='reading-text'>Tourism is an important industry for many countries. It brings in money and creates jobs. However, tourism can also cause problems. Too many tourists can damage the environment. For example, coral reefs are often destroyed by careless divers. Also, tourism can increase the cost of living for local people.</div>\nWhat is a benefit of tourism mentioned in the text?", 
            a: ["It creates jobs.", "It destroys coral reefs.", "It increases living costs.", "It causes pollution."], 
            correct: 0, 
            explain: "Text: 'It brings in money and creates jobs.'", 
            trans: "D·ªãch: L·ª£i √≠ch n√†o ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn? -> N√≥ t·∫°o ra vi·ªác l√†m.\n(B√†i ƒë·ªçc n√≥i v·ªÅ l·ª£i v√† h·∫°i c·ªßa du l·ªãch)."
        },
        {
            q: "<div class='reading-text'>English is spoken as a first language by about 400 million people. But it is used by more than 1 billion people as a second or foreign language. It is the language of business, science, and the internet. Learning English helps people communicate with the world.</div>\nHow many people speak English as a first language?", 
            a: ["About 400 million", "More than 1 billion", "7 billion", "Very few"], 
            correct: 0, 
            explain: "Text: '...spoken as a first language by about 400 million people.'", 
            trans: "D·ªãch: C√≥ kho·∫£ng bao nhi√™u ng∆∞·ªùi n√≥i ti·∫øng Anh nh∆∞ ng√¥n ng·ªØ m·∫π ƒë·∫ª? -> Kho·∫£ng 400 tri·ªáu."
        },

        // --- ERROR IDENTIFICATION ---
        {q: "Find the mistake: <br>If I <u>am</u> <u>you</u>, I <u>would</u> <u>go</u> there.", a: ["am", "you", "would", "go"], correct: 0, explain: "Sai 'am'. C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 2 d√πng 'were' cho m·ªçi ng√¥i.", trans: "D·ªãch: N·∫øu t√¥i l√† b·∫°n... (ph·∫£i d√πng were)."},
        {q: "Find the mistake: <br>The man <u>which</u> <u>helped</u> me <u>yesterday</u> is <u>my</u> teacher.", a: ["which", "helped", "yesterday", "my"], correct: 0, explain: "Sai 'which'. Ng∆∞·ªùi (The man) ph·∫£i d√πng 'who'.", trans: "D·ªãch: Ng∆∞·ªùi ƒë√†n √¥ng, ng∆∞·ªùi m√† gi√∫p t√¥i..."},
        {q: "Find the mistake: <br>I <u>visited</u> <u>the</u> London <u>last</u> <u>summer</u>.", a: ["the", "visited", "last", "summer"], correct: 0, explain: "Sai 'the'. Kh√¥ng d√πng m·∫°o t·ª´ tr∆∞·ªõc t√™n th√†nh ph·ªë London.", trans: "D·ªãch: T√¥i ƒë√£ thƒÉm London (b·ªè the)."},
        
        // --- COMMUNICATION ---
        {q: "A: 'I think we should protect the limestone caves.' <br>B: '______'", a: ["I agree with you.", "No, I don't.", "You're wrong.", "I don't think so."], correct: 0, explain: "ƒê·ªìng √Ω quan ƒëi·ªÉm b·∫£o v·ªá m√¥i tr∆∞·ªùng.", trans: "D·ªãch: A: T√¥i nghƒ© ch√∫ng ta n√™n b·∫£o v·ªá hang ƒë·ªông ƒë√° v√¥i. B: T√¥i ƒë·ªìng √Ω v·ªõi b·∫°n."},
        {q: "A: 'Would you like to go on a safari?' <br>B: '______'", a: ["Yes, I'd love to.", "Yes, I do.", "No, I won't.", "I like it."], correct: 0, explain: "Tr·∫£ l·ªùi l·ªùi m·ªùi 'Would you like...'.", trans: "D·ªãch: A: B·∫°n c√≥ mu·ªën ƒëi safari kh√¥ng? B: C√≥, m√¨nh r·∫•t th√≠ch."},
    ];

    // GENERATOR: T·ª∞ ƒê·ªòNG SINH C√ÇU H·ªéI NG·ªÆ PH√ÅP (ƒê·ªÇ ƒê·ª¶ 150 C√ÇU KH√îNG TR√ôNG)
    
    // 1. Conditional Type 2 Generator
    const cond2Verbs = [
        {v: "study", past: "studied", meaning: "h·ªçc"},
        {v: "work", past: "worked", meaning: "l√†m vi·ªác"},
        {v: "play", past: "played", meaning: "ch∆°i"},
        {v: "exercise", past: "exercised", meaning: "t·∫≠p th·ªÉ d·ª•c"}
    ];
    for(let i=0; i<20; i++) {
        let v = cond2Verbs[i % cond2Verbs.length];
        rawQuestions.push({
            q: `Grammar: If he ______ harder, he would get better grades.`,
            a: [v.past, v.v, `will ${v.v}`, `has ${v.past}`],
            correct: 0,
            explain: `C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 2 (M·ªánh ƒë·ªÅ If): If + S + V-ed/V2.`,
            trans: `D·ªãch: N·∫øu anh ·∫•y ${v.meaning} chƒÉm ch·ªâ h∆°n, anh ·∫•y s·∫Ω ƒë·∫°t ƒëi·ªÉm cao h∆°n.`
        });
    }

    // 2. Relative Clause Generator (Who/Which)
    const relSubjects = [
        {s: "The boy", type: "person", trans: "C·∫≠u b√©"},
        {s: "The woman", type: "person", trans: "Ng∆∞·ªùi ph·ª• n·ªØ"},
        {s: "The dog", type: "thing", trans: "Con ch√≥"},
        {s: "The car", type: "thing", trans: "Chi·∫øc xe"},
        {s: "The phone", type: "thing", trans: "ƒêi·ªán tho·∫°i"}
    ];
    for(let i=0; i<30; i++) {
        let subj = relSubjects[i % relSubjects.length];
        let rel = subj.type === "person" ? "who" : "which";
        let distractors = subj.type === "person" ? ["which", "where", "when"] : ["who", "where", "when"];
        
        rawQuestions.push({
            q: `Grammar: ${subj.s} ______ is standing there is my friend/mine.`,
            a: [rel, ...distractors],
            correct: 0,
            explain: `${subj.s} l√† danh t·ª´ ch·ªâ ${subj.type === "person" ? "ng∆∞·ªùi -> d√πng Who" : "v·∫≠t -> d√πng Which"}.`,
            trans: `D·ªãch: ${subj.trans} ƒëang ƒë·ª©ng ƒë√≥ l√† b·∫°n/c·ªßa t√¥i.`
        });
    }

    // 3. Articles Generator (Countries/Cities vs Common Nouns)
    const articleNouns = [
        {n: "Vietnam", a: "√ò", trans: "Vi·ªát Nam"},
        {n: "Paris", a: "√ò", trans: "Paris"},
        {n: "USA", a: "the", trans: "M·ªπ (vi·∫øt t·∫Øt)"},
        {n: "UK", a: "the", trans: "Anh (vi·∫øt t·∫Øt)"},
        {n: "Moon", a: "the", trans: "M·∫∑t TrƒÉng"},
        {n: "Sun", a: "the", trans: "M·∫∑t Tr·ªùi"},
        {n: "apple", a: "an", trans: "qu·∫£ t√°o"}
    ];
    for(let i=0; i<30; i++) {
        let item = articleNouns[i % articleNouns.length];
        rawQuestions.push({
            q: `Grammar: I want to visit/see ______ ${item.n}.`,
            a: [item.a, "a", "an", "the"].filter((v,i,a)=>a.indexOf(v)===i).slice(0,4), // Unique options
            correct: 0,
            explain: `Quy t·∫Øc m·∫°o t·ª´ v·ªõi "${item.n}": d√πng "${item.a}".`,
            trans: `D·ªãch: T√¥i mu·ªën thƒÉm/nh√¨n th·∫•y ${item.trans}.`
        });
        // Fix options length if filter reduced it
        if(rawQuestions[rawQuestions.length-1].a.length < 4) rawQuestions[rawQuestions.length-1].a = [item.a, "a", "the", "√ò"]; 
    }

    // 4. Impersonal Passive Generator
    const verbs = [
        {v1: "say", v3: "said", trans: "n√≥i"},
        {v1: "think", v3: "thought", trans: "nghƒ©"},
        {v1: "believe", v3: "believed", trans: "tin"},
        {v1: "expect", v3: "expected", trans: "mong ƒë·ª£i"}
    ];
    for(let i=0; i<20; i++) {
        let v = verbs[i % verbs.length];
        rawQuestions.push({
            q: `Grammar: It is ______ that English is important.`,
            a: [v.v3, v.v1, `is ${v.v3}`, `to ${v.v1}`],
            correct: 0,
            explain: `C·∫•u tr√∫c b·ªã ƒë·ªông kh√°ch quan: It is + V3/ed (${v.v3}) + that...`,
            trans: `D·ªãch: Ng∆∞·ªùi ta ${v.trans} r·∫±ng ti·∫øng Anh r·∫•t quan tr·ªçng.`
        });
    }

    // ========================================================================
    // GAME LOGIC
    // ========================================================================
    let questions = []; 
    let currentQuestionIndex = 0;
    let score = 0;
    let isPlaying = false;
    const audio = document.getElementById('bg-music');

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function toggleMusic() {
        if (audio.paused) {
            audio.play().catch(e => alert("Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ b·∫≠t nh·∫°c!"));
            document.getElementById('music-control').classList.add('music-playing');
        } else {
            audio.pause();
            document.getElementById('music-control').classList.remove('music-playing');
        }
    }

    function startGame() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.add('hidden');
        document.getElementById('game-ui').classList.remove('hidden');

        score = 0;
        currentQuestionIndex = 0;
        // L·∫•y 150 c√¢u ng·∫´u nhi√™n t·ª´ kho
        questions = shuffleArray([...rawQuestions]).slice(0, 150); 
        
        isPlaying = true;
        updateScore();
        showQuestion();

        if(audio.paused) toggleMusic();
    }

    function showQuestion() {
        if (currentQuestionIndex >= questions.length) {
            endGame();
            return;
        }
        
        const qData = questions[currentQuestionIndex];
        
        document.getElementById('question-text').innerHTML = `[${currentQuestionIndex + 1}] ${qData.q}`;
        document.getElementById('progress-display').innerText = `Question: ${currentQuestionIndex + 1}/${questions.length}`;
        
        document.getElementById('explanation-area').classList.add('hidden');
        document.getElementById('btn-next').style.display = 'none';

        const optionsDiv = document.getElementById('options-container');
        optionsDiv.innerHTML = '';
        let indices = [0, 1, 2, 3];
        shuffleArray(indices);

        indices.forEach(index => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerHTML = qData.a[index]; 
            btn.onclick = () => checkAnswer(index, qData.correct, btn);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, correctIndex, btnElement) {
        if (!isPlaying) return;
        
        const allBtns = document.querySelectorAll('.btn-option');
        allBtns.forEach(b => b.disabled = true);

        if (selectedIndex === correctIndex) {
            btnElement.classList.add('correct');
            score += 10;
        } else {
            btnElement.classList.add('wrong');
            allBtns.forEach(b => {
                if(b.innerHTML === questions[currentQuestionIndex].a[correctIndex]) {
                    b.classList.add('correct');
                }
            });
        }
        updateScore();

        // HI·ªÜN GI·∫¢I TH√çCH & D·ªäCH
        document.getElementById('explanation-text').innerText = questions[currentQuestionIndex].explain;
        
        const transEl = document.getElementById('trans-text');
        if(questions[currentQuestionIndex].trans) {
            transEl.innerText = questions[currentQuestionIndex].trans;
            transEl.style.display = 'block';
        } else {
            transEl.style.display = 'none';
        }

        document.getElementById('explanation-area').classList.remove('hidden');
        document.getElementById('btn-next').style.display = 'block';
    }

    function nextQuestion() {
        currentQuestionIndex++;
        showQuestion();
    }

    function updateScore() {
        document.getElementById('score-display').innerText = `Score: ${score}`;
    }

    function endGame() {
        isPlaying = false;
        document.getElementById('game-ui').classList.add('hidden');
        document.getElementById('end-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = `Total Score: ${score} / ${questions.length * 10}`;
    }
    
    // T·∫°o hoa r∆°i
    function createFlowers() {
        const container = document.getElementById('flowers');
        const symbols = ['üå∏', 'üçÇ', '‚ùÑÔ∏è', '‚òÄÔ∏è', 'üçÄ']; 
        for(let i=0; i<25; i++) {
            const el = document.createElement('div');
            el.className = 'flower';
            el.innerText = symbols[Math.floor(Math.random()*symbols.length)];
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 5 + 5) + 's';
            el.style.animationDelay = Math.random() * 5 + 's';
            container.appendChild(el);
        }
    }
    createFlowers();
</script>
</body>
</html>